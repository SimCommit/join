<section>
    <div>
        <div>
            <img (click)="goBackToLogin()" src="./img/icons/arrow-left-line.svg" alt="">
        </div>
        <h1>Sign up</h1>
        <div class="accent-line"></div>
    </div>

    <form #form="ngForm" action="signUp">
        <div class="input">
            <input [(ngModel)]="userName" #userNameInput="ngModel"
                [ngClass]="{'error-border': !userNameValid && (userNameInput.touched || form.submitted)}"
                placeholder="Full Name" required maxlength="28" type="text" name="userName" id="userName" autocomplete="on">
            <div>
                <img src="./img/icons/person.svg" alt="">
            </div>
            <p class="error" *ngIf="!userNameValid && (userNameInput.touched || form.submitted)">
                Please enter a valid username.
            </p>
        </div>
        <div class="input">
            <input [(ngModel)]="email" #emailInput="ngModel"
                [ngClass]="{'error-border': (!emailValid) && (emailInput.touched || form.submitted)}"
                placeholder="Email" required type="email" name="email" id="email" autocomplete="on">
            <div>
                <img src="./img/icons/mail.svg" alt="">
            </div>
            <p class="error" *ngIf="(!emailValid) && (emailInput.touched || form.submitted)">
                Please enter a valid email.
            </p>
        </div>
        <div class="input">
            <input #passwordInputEle (focus)="passwordInput = true" (blur)="passwordInput = false"
                [(ngModel)]="password"
                [ngClass]="{'error-border': passwordInputRef.invalid && (passwordInputRef.touched || form.submitted)}"
                #passwordInputRef="ngModel" [type]="showPassword? 'text' :'password'" required placeholder="Password"
                name="password" id="password" minlength="6">
            <div>
                <img *ngIf="!passwordInput && password.length == 0" src="./img/icons/lock.svg" alt="lock">
                <img *ngIf="(passwordInput || password.length > 0) && !showPassword"
                    (click)="togglePasswordVisibility('showPassword', passwordInputEle)"
                    src="./img/icons/visibility_off.svg" alt="visibility_off">

                <img *ngIf="(passwordInput || password.length > 0) && showPassword"
                    (click)="togglePasswordVisibility('showPassword', passwordInputEle)"
                    src="./img/icons/visibility.svg" alt="visibility">
            </div>
            <p class="error" *ngIf="passwordInputRef.invalid && (passwordInputRef.touched || form.submitted)">
                @if (password.length < 1 ) { Please enter your password. } @else { Your password is too short. } </p>
        </div>
        <div class="input">
            <input #passwordConfirmInputEle (focus)="passwordInputConfirm = true" (blur)="passwordInputConfirm = false"
                [(ngModel)]="confirmPassword" #confirmPasswordInputRef="ngModel"
                [ngClass]="{'error-border': (!doesPasswordMatch() || confirmPasswordInputRef.invalid) && (confirmPasswordInputRef.touched || form.submitted)}"
                [type]="showPasswordConfirm? 'text' :'password'" required name="confirmPassword" id="confirmPassword"
                placeholder="Confirm Password" minlength="6">
            <div>
                <img *ngIf="!passwordInputConfirm && confirmPassword.length == 0" src="./img/icons/lock.svg" alt="lock">
                <img *ngIf="(passwordInputConfirm || confirmPassword.length > 0) && !showPasswordConfirm"
                    (click)="togglePasswordVisibility('showPasswordConfirm', passwordConfirmInputEle)"
                    src="./img/icons/visibility_off.svg" alt="visibility_off">
                <img *ngIf="(passwordInputConfirm || confirmPassword.length > 0) && showPasswordConfirm"
                    (click)="togglePasswordVisibility('showPasswordConfirm', passwordConfirmInputEle)"
                    src="./img/icons/visibility.svg" alt="visibility">
            </div>
            <p class="error"
                *ngIf="confirmPasswordInputRef.invalid && (confirmPasswordInputRef.touched || form.submitted)">
                @if (confirmPassword.length > 5 || confirmPassword.length < 1 ) { Please confirm your password. } @else
                    { Your Password is too short. } </p>
                    <p class="error" *ngIf="!doesPasswordMatch() && confirmPassword.length > 5 && (confirmPasswordInputRef.touched || form.submitted)">
                        Your passwords do not match.
                    </p>
        </div>
        <div class="privacy-policy">
            <label
                [ngClass]="{'error-checkbox': confirmprivacyPolicyInpit.invalid && (confirmprivacyPolicyInpit.touched || form.submitted)}"
                class="checkbox-wrapper">
                <input [(ngModel)]="confirmprivacyPolicy" #confirmprivacyPolicyInpit="ngModel"
                    (change)="togleManualChange()" required type="checkbox" name="privacyPolicy" id="privacyPolicy">
                <span class="checkmark"></span>
            </label>
            <span>I accept the
                <a href="/privacy-policy">Privacy
                    policy</a>
            </span>
            <p class="error"
                *ngIf="confirmprivacyPolicyInpit.invalid && (confirmprivacyPolicyInpit.touched || form.submitted)">
                Please accept the privacy Policy.
            </p>
        </div>
        <div class="button-wrapper">
            <button (click)="onSignUp()" [disabled]="form.invalid || !emailValid || !userNameValid || !doesPasswordMatch()" type="submit">Sign up</button>
        </div>
    </form>

    <div class="feedback-overlay" *ngIf="errorMessage">
        {{ errorMessage }}
    </div>
</section>