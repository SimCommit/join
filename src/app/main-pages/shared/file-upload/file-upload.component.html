<section>
    <p id="attachments-heading">Attachments</p>

    <div class="upload-info-bar">
        <p>
            <small>You can attach up to 8 images per task.</small>
            <small>Supported formats: JPEG, JPG, WEBP</small>
        </p>
        @if (imagesForUpload.length > 0) {
        <button type="button" (click)="deleteAllImagesFromForm()">
            <img aria-hidden="true" src="./img/icons/delete_contact.svg" alt="">
            Delete all
        </button>
        }
    </div>

    <div class="dropzone" (dragover)="$event.preventDefault()" (drop)="addImagesByDrop($event)">
        <label for="filepicker">Drag a file or browse</label>
        <button type="button" (click)="filepicker.click()" aria-label="filepicker"
            aria-describedby="attachments-heading"
            [attr.aria-describedby]="  invalidFiles.length > 0 ? 'filepicker-error'  : null">
            <img aria-hidden="true" src="./img/icons/plus-upload-a11y-grey.svg" alt="">
        </button>
        <input type="file" name="filepicker" id="filepicker" #filepicker accept="image/jpeg, image/webp" multiple>
    </div>

    <app-attachments-gallery [imagesForUpload]="imagesForUpload" [deleteIsEnabled]="true"
        (deleteSingelImage)="deleteSingelImage($event)">
    </app-attachments-gallery>

    <div id="filepicker-error" class="error-wrapper">
        @if (errorTooManyImages()) {
        <p class="wrong-format">
            <strong>Too many files.</strong>
        </p>
        <p class="wrong-format">
            You can upload up to 8 images per task.
        </p>
        }

        @for (name of invalidFiles; track $index) {
        <p class="wrong-format"><strong>
                Invalid format: {{name}}
            </strong></p>
        }
        @if (invalidFiles.length > 0) {
        <p class="wrong-format">
            You can only upload JPEG, JPG and WEBP.
        </p>
        }

        @if (totalSizeExceededFiles.length > 0) {
        @for (name of totalSizeExceededFiles; track $index) {
        <p class="wrong-format">
            <strong>Stopped uploading image: {{totalSizeExceededFiles[$index]}}</strong>
        </p>
        }
        <p class="wrong-format">
            The task would exceed the 1 MB storage limit of Firestore.
            Try images smaller than 800x800 px or the more efficient format WEBP.
        </p>
        }

        @if (oversizedCompressedImages.length > 0) {
        @for (name of oversizedCompressedImages; track $index) {
        <p class="wrong-format">
            <strong>Oversized image: {{name}}</strong>
        </p>
        }
        <p class="wrong-format">
            Image may be up to 400 KB after compression.
            Try an image smaller than 800x800 px or the more efficient format WEBP.
        </p>
        }
    </div>
</section>